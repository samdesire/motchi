{
  "info": {
    "name": "Motchi API - Quickflow",
    "description": "Create users, obtain token via /connect, create a pet, then add a co-owner by username.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "Create Alice",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Alice\",\n  \"username\": \"alice\",\n  \"password\": \"alicepass\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/create_user",
          "host": ["{{baseUrl}}"],
          "path": ["create_user"]
        }
      },
      "response": []
    },
    {
      "name": "Create Bob",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Bob\",\n  \"username\": \"bob\",\n  \"password\": \"bobpass\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/create_user",
          "host": ["{{baseUrl}}"],
          "path": ["create_user"]
        }
      },
      "response": []
    },
    {
      "name": "Alice Connect (get token)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"username\": \"alice\",\n  \"password\": \"alicepass\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/connect",
          "host": ["{{baseUrl}}"],
          "path": ["connect"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "// Save access token into environment variable ALICE_TOKEN",
              "if (pm.response.code === 200 || pm.response.code === 201) {",
              "  var json = pm.response.json();",
              "  if (json.access_token) { pm.environment.set('ALICE_TOKEN', json.access_token); }",
              "  if (json.user_id) { pm.environment.set('ALICE_USER_ID', json.user_id); }",
              "  if (json.pet_id) { pm.environment.set('ALICE_PET_ID', json.pet_id); }",
              "}",
              "pm.test('Got access token', function () { pm.expect(pm.response.json()).to.have.property('access_token'); });"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "response": []
    },
    {
      "name": "Create Pet (Alice)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{ALICE_TOKEN}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Fluffy\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/create_pet",
          "host": ["{{baseUrl}}"],
          "path": ["create_pet"]
        }
      },
      "response": []
    },
    {
      "name": "Add Co-owner (Alice adds Bob)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{ALICE_TOKEN}}" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"username\": \"bob\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/add_co_owner",
          "host": ["{{baseUrl}}"],
          "path": ["add_co_owner"]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Added co-owner', function () { pm.response.to.have.status(200); });"
            ],
            "type": "text/javascript"
          }
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080"
    },
    {
      "key": "ALICE_TOKEN",
      "value": ""
    },
    {
      "key": "ALICE_USER_ID",
      "value": ""
    },
    {
      "key": "ALICE_PET_ID",
      "value": ""
    }
  ]
}
